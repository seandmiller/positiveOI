<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Path to Operating Profit Calculator</title>
   <link rel="stylesheet" href="static/css/style.css">
</head>
<body>
    <div class="container">
        <div class="card-header">
            <h2>Path to Operating Profit Calculator</h2>
        </div>
        <div class="card-content">
            <!-- Search Section -->
            <div class="search-section">
                <input
                    type="text"
                    id="tickerInput"
                    placeholder="Enter ticker symbol (e.g., AAPL)"
                    class="ticker-input"
                />
                <button id="searchButton" class="search-button">
                    <svg
                        viewBox="0 0 24 24"
                        class="search-icon"
                        fill="none"
                        stroke="currentColor"
                        stroke-width="2"
                    >
                        <circle cx="11" cy="11" r="8"></circle>
                        <line x1="21" y1="21" x2="16.65" y2="16.65"></line>
                    </svg>
                    Search
                </button>
            </div>

            <!-- Loading State -->
            <div id="loadingState" class="loading-state hidden">
                <p>Fetching company data...</p>
            </div>

            <!-- Status Display -->
            <div id="statusDisplay" class="status-display hidden">
                <div class="status-icon-container">
                    <svg
                        class="status-icon"
                        viewBox="0 0 24 24"
                        fill="none"
                        stroke="currentColor"
                        stroke-width="2"
                    >
                        <path d="M20 6L9 17l-5-5"></path>
                    </svg>
                </div>
                <p id="statusText"></p>
            </div>

            <!-- Results Display -->
            <div id="resultsDisplay" class="results-display hidden">
                <div class="metrics-grid">
                    <div class="metric-card">
                        <h4>Input Metrics</h4>
                        <div class="metric-content">
                            <p id="revenue"></p>
                            <p id="grossMargin"></p>
                            <p id="operatingExpenses"></p>
                            <p id="growthRate"></p>
                        </div>
                    </div>

                    <div class="metric-card blue">
                        <h4>Time to Profitability</h4>
                        <p id="timeToProfit" class="large-text"></p>
                        <p id="timeToYears" class="small-text"></p>
                    </div>
                </div>

                <div class="projected-metrics">
                    <h4>Projected Metrics at Profitability</h4>
                    <div class="metrics-grid-4">
                        <div>
                            <p class="label">Quarterly Revenue</p>
                            <p id="projectedRevenue" class="value"></p>
                        </div>
                        <div>
                            <p class="label">Gross Profit</p>
                            <p id="projectedGrossProfit" class="value"></p>
                        </div>
                        <div>
                            <p class="label">Operating Expenses</p>
                            <p id="projectedExpenses" class="value"></p>
                        </div>
                        <div>
                            <p class="label">Operating Profit</p>
                            <p id="projectedProfit" class="value"></p>
                        </div>
                    </div>
                </div>

                <div class="sentiment-metrics">
                    <h4>News Sentiment Analysis</h4>
                    <div class="sentiment-slider">
                        <div class="slider-labels">
                            <span>Very Negative</span>
                            <span>Very Positive</span>
                        </div>
                        <div class="slider-track">
                            <div id="sentimentHandle" class="slider-handle"></div>
                        </div>
                        <div class="slider-score">
                            <span id="sentimentScore"></span>
                        </div>
                    </div>
                    <div class="sentiment-summary">
                        <div class="sentiment-score">
                            <p class="label">Average Sentiment</p>
                            <p id="avgSentiment" class="value"></p>
                        </div>
                        <div class="sentiment-category">
                            <p class="label">Sentiment Category</p>
                            <p id="sentimentCategory" class="value"></p>
                        </div>
                        <div class="news-count">
                            <p class="label">News Articles Analyzed</p>
                            <p id="newsCount" class="value"></p>
                        </div>
                    </div>
                    <div class="recent-news">
                        <h5>Recent News</h5>
                        <div id="newsList" class="news-list"></div>
                    </div>
                </div>
            </div>

            <div class="formula-section">
                <h3 class="formula-title">Profitability Projection Formula</h3>
                <div class="formula">P(t) = [R₀(1 + g)^t × m] - [E₀(1 + e)^t]</div>
                <p class="formula-explanation">
                    This formula projects when a company will achieve profitability
                    where P(t) is the projected profit at time t, R₀ is initial
                    quarterly revenue, g is quarterly revenue growth rate, t is time in
                    quarters, m is gross margin as a decimal, E₀ is initial operating
                    expenses, and e is the operating expense growth rate. The company
                    achieves profitability when gross profit exceeds operating expenses.
                    <h4>This tool is best used for financial planning and determining the sensitivity of the profitability timeline to changes in key metrics like growth rate or gross margin. </h4>
                </p>
            </div>
        </div>
    </div>

    <script>
        const tickerInput = document.getElementById("tickerInput");
        const searchButton = document.getElementById("searchButton");
        const loadingState = document.getElementById("loadingState");
        const statusDisplay = document.getElementById("statusDisplay");
        const statusText = document.getElementById("statusText");
        const resultsDisplay = document.getElementById("resultsDisplay");

        const revenue = document.getElementById("revenue");
        const grossMargin = document.getElementById("grossMargin");
        const operatingExpenses = document.getElementById("operatingExpenses");
        const growthRate = document.getElementById("growthRate");
        const timeToProfit = document.getElementById("timeToProfit");
        const timeToYears = document.getElementById("timeToYears");
        const projectedRevenue = document.getElementById("projectedRevenue");
        const projectedExpenses = document.getElementById("projectedExpenses");
        const projectedProfit = document.getElementById("projectedProfit");
        const projectedGrossProfit = document.getElementById("projectedGrossProfit");

        searchButton.addEventListener("click", handleSearch);
        tickerInput.addEventListener("keypress", (e) => {
            if (e.key === "Enter") {
                handleSearch();
            }
        });

        async function handleSearch() {
            const ticker = tickerInput.value.trim().toUpperCase();

            if (!ticker) {
                showStatus("Please enter a ticker symbol", "error");
                return;
            }

            // Clear previous states
            hideStatus();
            hideResults();
            showLoading();

            try {
                // This would connect to your Flask API endpoint
                const response = await fetch(`/api/metrics/${ticker}`);
                if (!response.ok) {
                    throw new Error(await response.text());
                }
                const data = await response.json();
                displayResults(data);
                showStatus("Data fetched successfully", "success");
            } catch (err) {
                // For demo purposes, show sample data when API is not available
                showSampleData(ticker);
                showStatus("Demo data loaded (API not connected)", "success");
            } finally {
                hideLoading();
            }
        }

        function showSampleData(ticker) {
            const sampleData = {
                inputMetrics: {
                    quarterlyRevenue: 1250.5,
                    grossMargin: 72.5,
                    operatingExpenses: 980.2,
                    revenueGrowthRate: 15.3,
                    expenseGrowthRate: 8.7
                },
                profitability: {
                    quartersToProfitability: 6,
                    yearsToProfit: 1.5,
                    projectedRevenue: 2145.8,
                    projectedGrossProfit: 1555.7,
                    projectedExpenses: 1420.3,
                    projectedProfit: 135.4
                },
                sentiment: {
                    averageSentiment: 0.15,
                    sentimentCategory: "Positive",
                    newsCount: 12,
                    recentNews: [
                        {
                            title: `${ticker} reports strong quarterly earnings`,
                            date: "2025-06-20",
                            sentiment: 0.8
                        },
                        {
                            title: `${ticker} announces new product launch`,
                            date: "2025-06-19",
                            sentiment: 0.6
                        },
                        {
                            title: `Market volatility affects ${ticker} stock`,
                            date: "2025-06-18",
                            sentiment: -0.2
                        }
                    ]
                }
            };
            displayResults(sampleData);
        }

        function displayResults(data) {
            const { inputMetrics, profitability } = data;

            revenue.textContent = `Revenue: $${inputMetrics.quarterlyRevenue}M`;
            grossMargin.textContent = `Gross Margin: ${inputMetrics.grossMargin}%`;
            operatingExpenses.textContent = `Operating Expenses: $${inputMetrics.operatingExpenses}M`;
            growthRate.textContent = `Growth Rate: ${inputMetrics.revenueGrowthRate}%`;

            timeToProfit.textContent =
                typeof profitability.quartersToProfitability === "number"
                    ? `${profitability.quartersToProfitability} Quarters`
                    : profitability.quartersToProfitability;

            timeToYears.textContent =
                profitability.yearsToProfit === "N/A"
                    ? ""
                    : `(${profitability.yearsToProfit} years)`;

            projectedRevenue.textContent = `$${profitability.projectedRevenue}M`;
            projectedGrossProfit.textContent = `$${profitability.projectedGrossProfit}M`;
            projectedExpenses.textContent = `$${profitability.projectedExpenses}M`;
            projectedProfit.textContent = `$${profitability.projectedProfit}M`;

            showResults();

            if (data.sentiment) {
                document.getElementById("avgSentiment").textContent =
                    data.sentiment.averageSentiment.toFixed(2);
                document.getElementById("sentimentCategory").textContent =
                    data.sentiment.sentimentCategory;
                document.getElementById("newsCount").textContent = data.sentiment.newsCount;

                const handle = document.getElementById("sentimentHandle");
                const scoreDisplay = document.getElementById("sentimentScore");

                // Convert sentiment from -1:1 range to percentage for positioning
                const position = ((data.sentiment.averageSentiment + 1) / 2) * 100;
                handle.style.left = `${position}%`;

                // Update score display
                scoreDisplay.textContent = `${
                    data.sentiment.sentimentCategory
                } (${data.sentiment.averageSentiment.toFixed(2)})`;

                // Display recent news
                const newsList = document.getElementById("newsList");
                newsList.innerHTML = ""; // Clear existing news

                data.sentiment.recentNews.forEach((news) => {
                    const newsItem = document.createElement("div");
                    newsItem.className = "news-item";
                    const sentimentClass = getSentimentClass(news.sentiment);

                    newsItem.innerHTML = `
                        <p>${news.title}</p>
                        <p class="news-date">
                            ${news.date} - Sentiment: 
                            <span class="${sentimentClass}">
                                ${news.sentiment.toFixed(2)}
                            </span>
                        </p>
                    `;
                    newsList.appendChild(newsItem);
                });
            }
        }

        function getSentimentClass(sentiment) {
            if (sentiment >= 0.1) return "sentiment-positive";
            if (sentiment <= -0.1) return "sentiment-negative";
            return "sentiment-neutral";
        }

        function showLoading() {
            searchButton.disabled = true;
            loadingState.classList.remove("hidden");
        }

        function hideLoading() {
            searchButton.disabled = false;
            loadingState.classList.add("hidden");
        }

        function showStatus(message, type) {
            statusText.textContent = message;
            statusDisplay.classList.remove("hidden", "success", "error");
            statusDisplay.classList.add("visible", type);
        }

        function hideStatus() {
            statusDisplay.classList.remove("visible", "success", "error");
            statusDisplay.classList.add("hidden");
            statusText.textContent = "";
        }

        function showResults() {
            resultsDisplay.classList.remove("hidden");
        }

        function hideResults() {
            resultsDisplay.classList.add("hidden");
        }
    </script>
</body>
</html>
